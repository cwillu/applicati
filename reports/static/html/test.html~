<html>
<head>
  <script type="text/javascript" src="/static/javascript/jquery-1.2.6.js"></script>
  <script src="/static/javascript/ui.core.js"></script>
  <script src="/static/javascript/ui.draggable.js"></script>
  <script src="/static/javascript/ui.droppable.js"></script>
  <script type="text/javascript"> 
    wiab_tool = function(){
      tool = $('#wiab_tool');
      if (tool.length > 0)
        return tool;
//      $("body").append('<div id="wiab_tool" class="wiab_tool">test<br>test  \
//      </div>'); 
      alert("fail");
      return $('#wiab_tool');
      
    };
    
    var mouseX = null;
    var mouseY = null;
    var cancels = [];
    var timeouts = [];
    var was = null;
    $(document).ready(function(){
      $(".wiab").hover(function(){
        $(this).addClass("wiab_active")
      }, function(){
        $(this).removeClass("wiab_active")
      }).mouseup(function(){
        $(this).click();
        
        if ($(this).filter('a').attr('onClick'))
          return;
      
        href = $(this).filter('a').attr('href')
        if (href)
          window.location = href
      });

      $("#wiab_move").click(function(){
        alert('foo');
      });
      
    //mousedown( fn )
      $("*").mousedown(function(e){
        if (e.button != 0)
          return;
        was = $(this)
        e.stopPropagation();
        if (was.filter("a").length > 0)
          e.preventDefault();

        mouseX = e.clientX;
        mouseY = e.clientY;

        was.addClass("active");

        for (i in timeouts)
          clearTimeout(timeouts.pop());
        
        var checkMouse = function(e){
          //alert(e.clientX + ", " + mouseX + ", ");
          if (Math.abs(e.clientX-mouseX) > 2 || Math.abs(e.clientY-mouseY) > 2) 
            for (i in timeouts)
              clearTimeout(timeouts.pop());                           
        }

        cancels.push(function(){          
          was.removeClass("active moreActive");
          was.unbind('mousemove', checkMouse);
          was.unbind('mouseout', checkMouse);    
        });

        timeouts.push(setTimeout(function(){
          was.addClass("moreActive");
          wiab_tool().css({position: 'absolute', left: mouseX, top: mouseY}).fadeIn(100);
          was.focus();          
          cancels.push(function(){
            wiab_tool().fadeOut(100);
          });
        }, 300));

        $(this).mousemove(checkMouse).mouseout(checkMouse);
        //return false;
      }).mouseup(function(e){
        e.stopPropagation();
        for (i in timeouts)
          clearTimeout(timeouts.pop());

        while (cancels.length > 0)
          cancels.pop()();

        if (!(Math.abs(e.clientX-mouseX) > 2 || Math.abs(e.clientY-mouseY) > 2)){
          href = was.filter('a').attr('href')
          if (href)
            window.location = href
        }
      });
      
    });



      
      //  $("*").droppable({
//          accept: '*',
//          activeClass: 'droppable-active', 
//        	hoverClass: 'droppable-hover' 
//        });


//        $("*").droppable("destroy");


  </script>
  <style>
    .block {
    }
    .active {
	    //outline: 1px solid black;
    }
    .moreActive {
	    outline: 3px dotted black;
    }
    .wiab_tool {
      display: none;
      position: relative;
      width: 0px;
      height: 0px;
      left: 300px;
      top: 200px;      
    }
    .wiab {
      position: absolute;
      text-align: center;
      text-decoration: none;
      font-weight: bold;      
      line-height: 20px;
      color: #333333;
      width: 64px;
      height: 64px;      
      background: url("/static/images/button.png");
    }
    .wiab_active {
      color: #000044;
      background: url("/static/images/button-active.png");
    }
    img {
      position: absolute; 
      left: -128px;
      top: -128px;
      height: 256px; 
      width: 256px; 
      color: white;
    }
    .wiab_w {
      left: -128px;
      top: -32px;  
    }
    .wiab_sw {
      left: -96px;  
      bottom: -80px;
    }
    .wiab_s {
      left: -32px;
      bottom: -96px;
    }
    .wiab_se {
      right: -96px;  
      bottom: -80px;
    }
  </style>
</head>
<body>
<div id="wiab_tool" class="wiab_tool">
  <img id="wiab_image" src="/static/images/1.png" />
  <a id="wiab_move" class="wiab wiab_s"><br>Move</a>
  <a href="http://reddit.com" class="wiab wiab_sw"><br>Link</a>
  <a href="http://reddit.com" class="wiab wiab_se"><br>Delete</a>
  <a href="http://reddit.com" class="wiab wiab_w"><br>Edit</a>

</div>

  <div class="block"> testing </div>
  <a class="block" href="http://reddit.com">Test</a>
<table>
<tr><td>test</td><td>test</td><td>test</td><td>test</td><td>test</td></tr>
<tr><td>test</td><td>test</td><td>test</td><td>test</td><td>test</td></tr>
<tr><td>test</td><td>test</td><td>test</td><td>test</td><td>test</td></tr>
<tr><td>test</td><td>test</td><td>test</td><td>test</td><td>test</td></tr>
<tr><td>test</td><td>test</td><td>test</td><td>test</td><td>test</td></tr>

</table>

</body>
</html>
